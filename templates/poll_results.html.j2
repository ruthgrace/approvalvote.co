{% extends "base.html.j2" %}

{% block content %}
<div class="space-y-4">
  <h1 class="text-3xl font-medium">{{title}}</h1>
  <p class="text-lg text-gray-500">{{description}}</p>
  <p class="text-lg">Poll results: {{winners}}</p>
  <div class="container mx-auto px-4">
    <div style="display: flex; justify-content: space-around; gap: 20px;">
      <div style="flex: 1;">
        <h2 class="text-2xl font-bold mb-4">Votes</h2>
        <p>Here is a chart of the vote counts for each candidate. Keep in mind that voters can vote for as many candidates as they want.</p>
        <div id="chart" class="h-64"></div>
      </div>
    </div>
  </div>
  <hr />

  <h2 class="text-2xl font-medium">Did you have a different preferred result?</h2>
  <div class="bg-gray-50 rounded-3xl p-8 border border-gray-300 space-y-4">
    <p>You can see how many more votes the winners got than your preferred result. What was your preferred result?</p>
    <form hx-post="/resultsubmit" hx-target="#resultresponse" hx-swap="innerHTML">
      <input type="hidden" name="poll_id" value="{{ poll_id }}" />
      <input type="hidden" name="seats" value="{{ seats }}" />
      {% for id, candidate in candidates.items() %}
      <label>
        <input type="checkbox" name="poll_option" value="{{id}}|{{candidate}}" /> {{candidate}}
      </label>
      <br />
      {% endfor %}
    </div>
    <button type="resultsubmit" class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-6 py-4 rounded-full transition duration-150 ease-in-out">See how close your preferred candidates were to winning</button>
  </form>
  <div id="resultresponse"></div>
</div>
  <script>
    var options = {
      chart: {
        type: 'bar',
        height: '400'
      },
      series: [
        {
          name: 'Votes',
          data: {{vote_tally}}
        }
      ],
      xaxis: {
        categories: {{vote_labels}}
      },
      colors: ['#4F46E5'],
      plotOptions: {
        bar: {
          distributed: false,
          borderRadius: 4
        }
      }
    };

    var chart = new ApexCharts(document.querySelector('#chart'), options);
    chart.render();
  </script>
{% endblock %}